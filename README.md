# Ichimoku intraday indicator strategy

## Summary
This strategy is built upon the usage of ichimoku indicator. There are numerous strategies that can be derived from ichimoku indicators, this strategy however attempts to combine multiple signals from ichimoku. By waiting for multiple signal before making a trade entry, I hope that it can improve the profitability of the ichimoku strategy that only relies on single signal. 
 
Below signals from the ichimoku have been taken into consideration for this strategy:
1. TenKan line vs Kijun line
2. Senkou span, or cloud crossover
3. current price vs ichimoku cloud
4. Chikou line vs historical price

The idea here is, only the above four "rules" are met, should the strategy triggers respective action, either long or short or stay flat. Once a change in signal is observed, a respective action will be taken.  

It is worth noting that this strategy does not have any mechanical stop-loss or take-profit level. All actions are determined by the pre-set rules. Such setting in general might expose to some degree of risk of ruin. However, any position opened for this strategy will only stay open if the above four rules continue to be applied. In the event when any one of the rules are not fullfiled, a change in signal would be triggered and position will be squared.  

Based on such set up, this strategy might work best during the regime with medium to long term extension in price action. It might not work during a relatively tight range market, where it might be more exposed to false signal. 

## File explanation
### Rule-based(bt)
This file contains backtesting (bt) that I have executed for a set of xxxJPY pairs. The final output of a summary acts as performance evaluation of the strategy across these pairs.

### Rule-based(add chart)
This file contains a backtesting done on one particularly pair. It also includes a graph that indicate accumulated PnL across the backtest period and the drawdown information. 


## Workflow
### The data
Intraday data of mid price for open, high, low and close her hour are extracted using the API from Refinitiv Reuters, which only has maximum of one year worth of intraday hourly data.
The data is indexed with timestamp, and generated as a dataframe. The data is a time series data. 

### Feature engineering
I did not rely on any technical indicator library. Furthermore, upon researching online, the libraries available online looks to be slightly different from the chart setup on Bloomberg.  

Therefore, I decided to build my own ichimoku indicator that replicate the chart setting in Bloomberg. This includes the tenkan line, kijun line, senkou span and chikou line.

### Set up trading rules
This is the fun part. Across the internet, I was not able to find any backtesting program that takes consideration of the past, present and the future values in the chart.  I decided to build that on my own by bringing the "future" value backward and the "past" forward to the same index. I believe this is only possible when I build all the indicator from the ground up. I am able to isolate each value of the indicators, as if I was looking at the chart live on the hourly basis. This perfectly replicates live trading environment, where user would look at indicators that are in the past, in the present and the future to determine trading signal. Trading signal is generated by running through a series of netted if, which encompasses the logics mentioned above. The signal would return "flag", "long" or "short", indicating the direction exposure. This will be used for trading decision. 

### Set up trading simulation and evaluation
- Signal assumed to be "flat" at the start, assuming no existing position
- Once the signal indicated "long" or "short", a trade will be open using the closing price. 
- Open trade will not be evaluated for unrealsied PnL. 
- The trade will be closed when there is a change in signal. E.g. if signal was long, it would stay long, until signal was changed to flat/short, the trade will be closed.
- Performance matrix would be evaluated on the list of PnL, and a final performance summary would be generated into a dataframe

  
## Challenges
### Building ichimoku indicator
The charting in Bloomberg display both future values and historical values, meaning the data points are not displayed in the same index. Different indicators in the ichimoku have different degree of lead and lag. It is rather intuitive for a human to compare and decide tradable action. However, since they are not in the same index, computer backtesting was proven to have limited capacity. This is unless a proper indexing and massage of data was done. Therefore, the challenge here is to make sure all the indicators, both lagged and lead, have been calculated correctly, and are referenced correctly. This requires manual cross check on each hourly data point to ensure accuracy. 

### Lack of open-trade timely evaluation
PnL was not evaluated until a change in signal. It is possible for the market to make violent move within an hour, especially with cross JPY when it comes to BOJ intervention. Since the signal will not be evaluated until the next hour, the potential drawdown during the period could be painful and lack proper risk management for such event. However, in the final evaluation, it looks like such event did not happen, as the amount of maximum drawdown is still below the amount that the algorithm can make. 

### Not the most efficient
A multiple nested ifs have been put inplace to evaluate the "signal". Another set of nested ifs are then used to determine trading decisions. It does take a considerable amount of time to run backtest for one currency pair. There might be more efficiency ways to make the codes, I am open to suggestions.
